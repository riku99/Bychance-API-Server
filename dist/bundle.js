(()=>{"use strict";var e={3157:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkConsoleAdmin=t.checkRecommendationClient=t.checkBeareAccessToken=void 0;const r=o(a(4054)),i=a(212),n=a(2306),d=new i.PrismaClient,s={isValid:!1,credentials:{}};t.checkBeareAccessToken=async(e,t,a)=>{const o=e.query.id;if(!o)return{isValid:!1,credentials:{}};const r=await d.user.findUnique({where:{id:o}});return r&&r.accessToken===n.createHash(t)?{isValid:!0,credentials:{},artifacts:r}:{isValid:!1,credentials:{}}},t.checkRecommendationClient=async(e,t,a)=>{const o=r.default.app("recommendationClient");try{const{uid:e}=await o.auth().verifyIdToken(t),a=await d.recommendationClient.findUnique({where:{uid:e}});return a?{isValid:!0,credentials:{},artifacts:a}:s}catch(e){return s}},t.checkConsoleAdmin=async(e,t,a)=>{const o=r.default.app("console");try{return await o.auth().verifyIdToken(t),{isValid:!0,credentials:{},artifacts:{}}}catch(e){return s}}},5854:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.invalidErrorType=t.loginErrorType=void 0,t.loginErrorType="loginError",t.invalidErrorType="invalidError"},6524:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maxBytes=void 0,t.maxBytes=1e8},8396:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.signupTokenExpirationHours=t.maxBytes=t.geohashPrecision=t.flashDisplayTime=t.baseUrl=t.dayMs=void 0,t.dayMs=864e5,t.baseUrl="/api/v1",t.flashDisplayTime=12,t.geohashPrecision=6,t.maxBytes=1e8,t.signupTokenExpirationHours=2},8927:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLoginData=void 0;const o=new(a(212).PrismaClient);t.getLoginData=async e=>o.user.findUnique({where:{id:e},select:{id:!0,name:!0,avatar:!0,introduce:!0,backGroundItem:!0,backGroundItemType:!0,instagram:!0,twitter:!0,youtube:!0,tiktok:!0,videoEditDescription:!0,statusMessage:!0,lat:!0,lng:!0,display:!0,talkRoomMessageReceipt:!0,showReceiveMessage:!0,intro:!0,posts:{orderBy:{createdAt:"desc"}},flashes:{include:{viewed:{select:{userId:!0}}}}}})},9309:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const o=new(a(7617).PrismaClient);t.handlers={create:async(e,t)=>{const a=e.auth.artifacts,r=e.payload;return await o.block.create({data:{blockBy:a.id,blockTo:r.blockTo}}),t.response().code(200)},_delete:async(e,t)=>{const a=e.auth.artifacts,r=e.params;return await o.block.delete({where:{blockBy_blockTo:{blockBy:a.id,blockTo:r.userId}}}),t.response().code(200)}}},3714:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clientSignupTokenHandler=void 0;const o=a(212),r=a(3879),i=a(6760),n=a(2306),d=a(8396),s=new o.PrismaClient;t.clientSignupTokenHandler={getClientSignupToken:async(e,t)=>{const a=e.params,o=await s.clientSignupToken.findUnique({where:{token:a.signupToken}});return o?(await s.clientSignupToken.delete({where:{token:a.signupToken}}),r.differenceInHours(new Date,o.createdAt)>d.signupTokenExpirationHours?i.throwInvalidError("有効期限が切れています"):t.response().code(200)):i.throwInvalidError("間違っています")},create:async e=>{if(!e.auth.artifacts.admin)return i.throwInvalidError();const t=n.createRandomString().slice(0,8);return await s.clientSignupToken.create({data:{token:t}}),t}}},961:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deviceTokenHandler=void 0;const o=new(a(212).PrismaClient);t.deviceTokenHandler={createDeviceToken:async(e,t)=>{const a=e.auth.artifacts,r=e.payload;return await o.deviceToken.findUnique({where:{token:r.token}})||await o.deviceToken.create({data:{userId:a.id,token:r.token}}),t.response().code(200)}}},5947:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const o=new(a(212).PrismaClient);t.handlers={createFlashStamp:async(e,t)=>{const a=e.auth.artifacts,r=e.payload;try{await o.flashStamp.create({data:{userId:a.id,flashId:r.flashId,value:r.value}})}catch{}return{userId:a.id,flashId:r.flashId,value:r.value}},get:async(e,t)=>{const a=e.params,r=await o.flashStamp.findMany({where:{flashId:Number(a.flashId)}});let i={};return r.forEach((e=>{i[e.value]?i[e.value].userIds.push(e.userId):i[e.value]={userIds:[e.userId]}})),i}}},3197:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flashesHabdler=void 0;const o=a(212),r=a(1151),i=a(6760),n=new o.PrismaClient;t.flashesHabdler={createFlash:async(e,t)=>{const a=e.auth.artifacts,o=e.payload,d=await r.createS3ObjectPath({data:o.source,domain:"flash",id:a.id,ext:o.ext,sourceType:o.sourceType});return d?await n.flash.create({data:{source:d.source,sourceType:o.sourceType,userId:a.id}}):i.throwInvalidError()},deleteFlash:async(e,t)=>{const a=e.auth.artifacts,o=e.params;if(!await n.flash.findFirst({where:{id:Number(o.flashId),userId:a.id}}))return i.throwInvalidError();const r=n.flashStamp.deleteMany({where:{flashId:Number(o.flashId)}}),d=n.viewedFlash.deleteMany({where:{flashId:Number(o.flashId)}}),s=n.flash.delete({where:{id:Number(o.flashId)}});return await n.$transaction([r,d,s]),t.response().code(200)}}},8166:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const r=a(212),i=o(a(8366)),n=a(4801),d=o(a(4065)),s=a(2306),l=a(3147),c=a(8396),u=a(6760),p=new r.PrismaClient;t.handlers={get:async(e,t)=>{const a=e.auth.artifacts,o=e.query;if(!a.lat||!a.lng)return u.throwInvalidError();const{lat:r,lng:h}=s.handleUserLocationCrypt(a.lat,a.lng,"decrypt"),m=n.point([h,r]),f=d.default.encode(r,h,c.geohashPrecision),v=s.createHash(f),g=d.default.neighbors(f).map((e=>s.createHash(e))),y=await p.user.findMany({where:{display:!0,login:!0,inPrivateZone:!1,geohash:{in:[v,...g]},lat:{not:null},lng:{not:null},blocks:{none:{blockTo:a.id}},blocked:{none:{blockBy:a.id}}},select:{id:!0,name:!0,avatar:!0,statusMessage:!0,introduce:!0,privateTime:!0,lat:!0,lng:!0,flashes:{include:{viewed:{select:{userId:!0}}}}}}),w=new Date,_=w.getHours(),b=w.getMinutes();return y.map((e=>{if(!e.lat||!e.lng)return;if(e.privateTime.find((e=>{const{startHours:t,startMinutes:a,endHours:o,endMinutes:r}=e;return l.confirmInTime({startHours:t,startMinutes:a,endHours:o,endMinutes:r,h:_,m:b})})))return;const{lat:t,lng:a}=s.handleUserLocationCrypt(e.lat,e.lng,"decrypt"),r=n.point([a,t]);if(i.default(m,r,{units:"kilometers"})>o.range)return;const{lat:d,lng:c,privateTime:u,flashes:p,...h}=e;return{...h,lat:t,lng:a,flashes:p}})).filter((e=>void 0!==e)).sort(((e,t)=>{const a={lat:e.lat,lng:t.lng},o={lat:t.lat,lng:t.lng};return i.default(n.point([a.lng,a.lat]),m)<i.default(n.point([o.lng,o.lat]),m)?-1:1}))}}},833:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.nonceHandler=void 0;const o=a(4832);t.nonceHandler={create:async(e,t)=>{const{nonce:a}=e.payload;try{return await o.Nonce.create({nonce:a}),t.response().code(200)}catch(e){console.log(e)}}}},2700:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const o=a(212),r=a(1151),i=a(6760),n=new o.PrismaClient;t.handlers={createPost:async(e,t)=>{const a=e.auth.artifacts,o=e.payload,d=await r.createS3ObjectPath({data:o.source,domain:"post",id:a.id,ext:o.ext,sourceType:o.sourceType});return d?await n.post.create({data:{url:d.source,text:o.text,sourceType:o.sourceType,user:{connect:{id:a.id}}}}):i.throwInvalidError()},deletePost:async(e,t)=>{const a=e.auth.artifacts,o=e.params;return(await n.post.deleteMany({where:{id:o.postId,userId:a.id}})).count?t.response().code(200):i.throwInvalidError()},getUserPosts:async(e,t)=>{const a=e.params;return await n.post.findMany({where:{userId:a.userId},select:{id:!0,text:!0,url:!0,createdAt:!0,userId:!0,sourceType:!0},orderBy:{createdAt:"desc"}})}}},2669:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.privateTimeHandler=void 0;const o=a(212),r=a(6760),i=new o.PrismaClient;t.privateTimeHandler={createPrivateTime:async(e,t)=>{const a=e.auth.artifacts,{startHours:o,startMinutes:r,endHours:n,endMinutes:d}=e.payload,s=await i.privateTime.create({data:{startHours:o,startMinutes:r,endHours:n,endMinutes:d,userId:a.id}});return{id:s.id,startHours:s.startHours,startMinutes:s.startMinutes,endHours:s.endHours,endMinutes:s.endMinutes}},getPrivateTime:async(e,t)=>{const a=e.auth.artifacts;return await i.privateTime.findMany({where:{userId:a.id},select:{id:!0,startHours:!0,startMinutes:!0,endHours:!0,endMinutes:!0},orderBy:{createdAt:"desc"}})},deletePrivateTime:async(e,t)=>{const a=e.auth.artifacts,o=e.params;return(await i.privateTime.deleteMany({where:{id:Number(o.id),userId:a.id}})).count?t.response().code(200):r.throwInvalidError()}}},6082:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.privateZoneHandler=void 0;const r=a(212),i=o(a(8366)),n=a(4801),d=a(6760),s=a(2306),l=new r.PrismaClient;t.privateZoneHandler={getPrivateZone:async(e,t)=>{const a=e.auth.artifacts;return(await l.privateZone.findMany({where:{userId:a.id},select:{id:!0,address:!0},orderBy:{createdAt:"desc"}})).map((e=>{const t=s.handleAddressCrypt(e.address,"decrypt");return{id:e.id,address:t}}))},createPrivateZone:async(e,t)=>{const a=e.auth.artifacts,o=e.payload,r=s.handleUserLocationCrypt(o.lat,o.lng,"encrypt"),d=s.handleAddressCrypt(o.address,"encrypt"),c=await l.privateZone.create({data:{userId:a.id,lat:r.lat,lng:r.lng,address:d}});if(a.lat&&a.lng&&!a.inPrivateZone){const e=s.handleUserLocationCrypt(a.lat,a.lng,"decrypt"),t=n.point([o.lng,o.lat]),r=n.point([e.lng,e.lat]);i.default(t,r)<=Number(process.env.PRIVATE_ZONE_RANGE)&&await l.user.update({where:{id:a.id},data:{inPrivateZone:!0}})}return{id:c.id,address:o.address}},deletePrivateZone:async(e,t)=>{const a=e.auth.artifacts,o=e.params;if(!(await l.privateZone.deleteMany({where:{id:Number(o.id),userId:a.id}})).count)return d.throwInvalidError();if(a.lat&&a.lng&&a.inPrivateZone){const e=await l.privateZone.findMany({where:{userId:a.id}}),t=s.handleUserLocationCrypt(a.lat,a.lng,"decrypt"),o=n.point([t.lng,t.lat]);e.find((e=>{const t=s.handleUserLocationCrypt(e.lat,e.lng,"decrypt"),a=n.point([t.lng,t.lat]);return i.default(a,o)<=Number(process.env.PRIVATE_ZONE_RANGE)}))||await l.user.update({where:{id:a.id},data:{inPrivateZone:!1}})}return t.response().code(200)}}},6745:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const o=a(212),r=a(6760),i=new o.PrismaClient;t.handlers={create:async(e,t)=>{const a=e.payload,o=e.params,n=e.auth.artifacts;if(!await i.talkRoom.findFirst({where:{id:Number(o.talkRoomId),OR:[{senderId:n.id},{recipientId:n.id}]}}))return r.throwInvalidError();const d=a.ids.map((e=>({userId:n.id,roomId:Number(o.talkRoomId),messageId:e})));try{await i.readTalkRoomMessage.createMany({data:d})}catch(e){}return t.response().code(200)}}},1115:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const o=a(212),r=a(6760),i=new o.PrismaClient;t.handlers={getAll:async(e,t)=>await i.recommendationClientNotification.findMany({orderBy:{createdAt:"desc"}}),getData:async(e,t)=>{const a=e.params;return await i.recommendationClientNotification.findUnique({where:{id:Number(a.id)}})||r.throwInvalidError("データが存在しません")},create:async(e,t)=>{const a=e.payload;return await i.recommendationClientNotification.create({data:{title:a.title,text:a.text}}),t.response().code(200)},getUnread:async(e,t)=>{const a=e.auth.artifacts;return await i.recommendationClientNotification.findMany({where:{alreadyRead:{none:{clientId:a.id}}},select:{id:!0},orderBy:{createdAt:"desc"}})}}},4606:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const o=a(212),r=a(6760),i=new o.PrismaClient;t.handlers={create:async(e,t)=>{const a=e.auth.artifacts,o=e.payload.ids.map((e=>({clientId:a.id,notificationId:e})));try{await i.recommendationClientReadNotification.createMany({data:o})}catch(e){return r.throwInvalidError(e)}return t.response().code(200)}}},9380:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationHandler=void 0;const r=a(212),i=o(a(4065)),n=a(1151),d=a(6760),s=a(2306),l=new r.PrismaClient;t.recommendationHandler={create:async(e,t)=>{const a=e.auth.artifacts,{title:o,text:r,images:i,coupon:s,endTime:c}=e.payload;if(await l.recommendation.findFirst({where:{display:!0,clientId:a.id}}))return d.throwInvalidError("一度に複数の掲載をすることはできません");let u=[];i.forEach((e=>{u.push(n.createS3ObjectPath({data:e.src,domain:"recommendation",id:a.id,ext:e.ext}))}));const p=await Promise.all(u);if(p.some((e=>!e)))return d.throwInvalidError();const h=await l.recommendation.create({data:{title:o,text:r,coupon:s,endTime:c,clientId:a.id}});let m=[];return p.forEach((e=>{m.push(l.recommendationImage.create({data:{url:e.source,recommendationId:h.id}}))})),await Promise.all(m),t.response().code(200)},getForClient:async(e,t)=>{const a=e.auth.artifacts,{type:o}=e.query;return await l.recommendation.findMany({where:"now"===o?{clientId:a.id,display:!0,OR:[{endTime:{gt:new Date}},{endTime:null}]}:{clientId:a.id,OR:[{display:!0,endTime:{lt:new Date}},{display:!1}]},select:{id:!0,title:!0,coupon:!0,text:!0,images:{select:{url:!0}},client:{select:{name:!0,image:!0,url:!0,instagram:!0,twitter:!0,address:!0,lat:!0,lng:!0}}},orderBy:{createdAt:"desc"}})},hide:async(e,t)=>{const a=e.auth.artifacts,o=e.params;return(await l.recommendation.updateMany({where:{id:Number(o.id),clientId:a.id},data:{display:!1}})).count?t.response().code(200):d.throwInvalidError()},get:async(e,t)=>{const a=e.auth.artifacts,o=e.query,r=i.default.encode(o.lat,o.lng,7),n=s.createHash(r),d=i.default.neighbors(r).map((e=>s.createHash(e)));return await l.recommendation.findMany({where:{display:!0,OR:[{endTime:{gt:new Date}},{endTime:null}],client:{deleted:!1,geohash:{in:[n,...d]}},hiddenRecommendations:{none:{userId:a.id}}},select:{id:!0,title:!0,coupon:!0,text:!0,images:{select:{url:!0}},client:{select:{name:!0,image:!0,url:!0,instagram:!0,twitter:!0,address:!0,lat:!0,lng:!0}}},orderBy:{createdAt:"desc"}})}}},7833:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationClientHandler=void 0;const r=a(212),i=o(a(4054)),n=a(6760),d=o(a(4065)),s=a(1151),l=a(2306),c=new r.PrismaClient,u=e=>{const{id:t,name:a,image:o,lat:r,lng:i,address:n,instagram:d,twitter:s,url:l,enablePushNotification:c,showedPostModal:u,admin:p}=e;return{id:t,name:a,image:o,lat:r,lng:i,address:n,instagram:d,twitter:s,url:l,enablePushNotification:c,showedPostModal:u,admin:p}};t.recommendationClientHandler={create:async(e,t)=>{const a=e.payload,o=e.headers.authorization.split(" ")[1],r=i.default.app("recommendationClient");let d;try{d=(await r.auth().verifyIdToken(o)).uid}catch(e){return n.throwLoginError()}const s=await c.recommendationClient.create({data:{name:a.name,uid:d}});return{id:s.id,name:s.name}},get:async(e,t)=>{const a=e.auth.artifacts;return u(a)},update:async(e,t)=>{const a=e.auth.artifacts,{name:o,image:r,address:i,url:p,instagram:h,twitter:m,ext:f,lat:v,lng:g}=e.payload;let y,w;if(r&&f){const e=await s.createS3ObjectPath({data:r,domain:"rClientProfileImage",id:a.id,ext:f});if(!e)return n.throwInvalidError("画像を作成できませんでした");y=e.source}if(v&&g){const e=d.default.encode(v,g,7);w=l.createHash(e)}const _=await c.recommendationClient.update({where:{id:a.id},data:{name:o,address:i,url:p,instagram:h,twitter:m,image:y,lat:v,lng:g,geohash:w}});return u(_)},changeShowedPostModal:async(e,t)=>{const a=e.auth.artifacts;return await c.recommendationClient.update({where:{id:a.id},data:{showedPostModal:!0}}),t.response().code(200)},deleteClient:async(e,t)=>{const a=e.auth.artifacts,o=i.default.app("recommendationClient");return await c.recommendationClient.update({where:{id:a.id},data:{name:"",image:null,address:null,instagram:null,twitter:null,lat:null,lng:null,geohash:null,deleted:!0,url:null}}),await c.recommendation.updateMany({where:{clientId:a.id},data:{display:!1}}),await o.auth().deleteUser(a.uid),t.response().code(200)}}},3560:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sessionsHandler=t.logout=t.sessionLogin=void 0;const r=o(a(2376)),i=a(212),n=a(2306),d=a(6760),s=a(8927),l=new i.PrismaClient,c=e=>{if(!e)return;const{posts:t,flashes:a,...o}=e,{lat:r,lng:i,...d}=o;let s=null,l=null;if(r&&i){const{lat:e,lng:t}=n.handleUserLocationCrypt(r,i,"decrypt");s=e,l=t}return{user:{...d,lat:s,lng:l},posts:t,flashes:a}};t.sessionLogin=async(e,t)=>{const a=e.auth.artifacts;a.login||await l.user.update({where:{id:a.id},data:{login:!0}});const o=await s.getLoginData(a.id);return o?c(o):d.throwLoginError()},t.logout=async(e,t)=>{const a=e.auth.artifacts;return await l.deviceToken.deleteMany({where:{userId:a.id}}),await l.user.update({where:{id:a.id},data:{login:!1}}),t.response().code(200)},t.sessionsHandler={lineLogin:async(e,t)=>{const a=`id_token=${e.headers.authorization.split(" ")[1]}&client_id=${process.env.ChannelId}`;let o;try{o=await r.default.post("https://api.line.me/oauth2/v2.1/verify",a,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}catch(e){return console.log(e),void d.throwLoginError()}const i=o.data.nonce;if(!await l.nonce.findUnique({where:{nonce:i}}))return void d.throwLoginError();await l.nonce.delete({where:{nonce:i}});const u=o.data.sub,p=n.createHash(u),h=n.createRandomString(),m=n.createHash(h),f=o.data.name,v=o.data.picture?o.data.picture:null,g=await l.user.findUnique({where:{lineId:p},select:{id:!0}});let y;if(g)await l.user.update({where:{id:g.id},data:{accessToken:m,login:!0}}),y=await s.getLoginData(g.id);else{const e=await l.user.create({data:{lineId:p,accessToken:m,name:f,avatar:v}});y=await s.getLoginData(e.id)}return{...c(y),accessToken:h}},sessionLogin:t.sessionLogin,logout:t.logout,sampleLogin:async(e,t)=>{const a=await l.user.findUnique({where:{id:"46a4db78-c5c5-4d85-b11d-a32e93f025f1"},select:{id:!0}});if(!a)return d.throwLoginError();await l.user.update({where:{id:"46a4db78-c5c5-4d85-b11d-a32e93f025f1"},data:{login:!0}});const o=await s.getLoginData(a.id);return{...c(o),accessToken:"denzi"}}}},7964:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const o=a(212),r=a(6873),i=a(6760),n=a(5802),d=new o.PrismaClient;t.handlers={create:async(e,t)=>{const a=e.auth.artifacts,o=e.payload,s=e.params,l=Number(s.talkRoomId);if(await d.block.findUnique({where:{blockBy_blockTo:{blockBy:a.id,blockTo:o.partnerId}}}))return i.throwInvalidError("このユーザーをブロックしています");const c=await d.talkRoom.findFirst({where:{id:l,OR:[{senderId:a.id,recipientId:o.partnerId},{recipientId:a.id,senderId:o.partnerId}]},select:{id:!0,updatedAt:!0,messages:{where:{OR:[{userId:o.partnerId},{userId:{not:a.id},receipt:!0}]}},recipient:{include:{deviceToken:!0,blocks:{where:{blockBy:o.partnerId,blockTo:a.id}}}},sender:{include:{deviceToken:!0,blocks:{where:{blockBy:o.partnerId,blockTo:a.id}}}}}});if(!c)return{talkRoomPrecence:!1,talkRoomId:l};const u=c.sender.id===o.partnerId?c.sender:c.recipient,p=await d.block.findUnique({where:{blockBy_blockTo:{blockBy:o.partnerId,blockTo:a.id}}}),h=await d.talkRoomMessage.create({data:{userId:a.id,roomId:l,text:o.text,receipt:!p&&u.talkRoomMessageReceipt},select:{id:!0,userId:!0,roomId:!0,text:!0,createdAt:!0}});if(!u.talkRoomMessageReceipt||!u.login||p)return{talkRoomPrecence:!0,message:h};const m={message:h,sender:{id:a.id,name:a.name,avatar:a.avatar},show:u.showReceiveMessage};r.talkRoomMessageNameSpace.to(o.partnerId).emit("recieveTalkRoomMessage",m);const f=u.deviceToken.map((e=>e.token));return n.pushNotificationToMany({tokens:f,notification:{title:"メッセージが届きました"},data:{type:"talkRoomMessages",talkRoomId:String(l),partnerId:a.id},apns:{payload:{aps:{sound:"default",contentAvailable:!0}}}}),{talkRoomPrecence:!0,message:h}},gets:async(e,t)=>{const a=e.auth.artifacts,o=e.params,r=Number(o.talkRoomId),i=await d.talkRoom.findFirst({where:{id:r,OR:[{senderId:a.id},{recipientId:a.id}]},select:{messages:{where:{OR:[{userId:a.id},{userId:{not:a.id},receipt:!0}]},select:{id:!0,userId:!0,text:!0,createdAt:!0},orderBy:{createdAt:"desc"}}}});return i?{roomPresence:!0,messages:i.messages}:{roomPresence:!1,messages:[]}}}},731:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const o=a(212),r=a(6760),i=new o.PrismaClient;t.handlers={createTalkRoom:async(e,t)=>{const a=e.auth.artifacts,o=e.payload,r=await i.talkRoom.findMany({where:{OR:[{senderId:a.id,recipientId:o.partnerId},{senderId:o.partnerId,recipientId:a.id}]}}),n=r.length?r[0]:null;if(n)return{presence:!0,roomId:n.id,timestamp:n.updatedAt.toString()};const d=await i.talkRoom.create({data:{senderId:a.id,recipientId:o.partnerId}});return{presence:!1,roomId:d.id,timestamp:d.createdAt.toString()}},deleteTalkRoom:async(e,t)=>{const a=e.params;await i.readTalkRoomMessage.deleteMany({where:{roomId:a.talkRoomId}}),await i.talkRoomMessage.deleteMany({where:{roomId:a.talkRoomId}});try{await i.talkRoom.delete({where:{id:a.talkRoomId}})}catch{}return t.response().code(200)},get:async(e,t)=>{const a=e.auth.artifacts,o=e.params;return a.id!==o.userId?r.throwInvalidError():await i.talkRoom.findMany({where:{OR:[{senderId:o.userId,messages:{some:{}}},{recipientId:o.userId,messages:{some:{receipt:!0}}}]},select:{id:!0,updatedAt:!0,unreadMessages:{where:{userId:{not:o.userId},receipt:!0,readTalkRoomMessages:{none:{userId:o.userId}}},select:{id:!0}},lastMessage:{where:{OR:[{userId:o.userId},{userId:{not:o.userId},receipt:!0}]},orderBy:{createdAt:"desc"},take:1,select:{id:!0,text:!0,userId:!0,createdAt:!0}},sender:{select:{id:!0,name:!0,avatar:!0,blocked:!0}},recipient:{select:{id:!0,name:!0,avatar:!0,blocked:!0}}}})}}},4244:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const o=new(a(212).PrismaClient);t.handlers={create:async(e,t)=>{const a=e.auth.artifacts,r=e.payload;return await o.userHideRecommendation.create({data:{recommendationId:r.id,userId:a.id}}),t.response().code(200)}}},5900:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const o=a(212),r=a(6760),i=new o.PrismaClient;t.handlers={changeDisplay:async(e,t)=>{const a=e.auth.artifacts,o=e.payload;try{await i.user.update({where:{id:a.id},data:{display:o.display}})}catch{return r.throwInvalidError()}return t.response().code(200)},changeVideoEditDescription:async(e,t)=>{const a=e.auth.artifacts,o=e.payload;try{await i.user.update({where:{id:a.id},data:{videoEditDescription:o.videoEditDescription}})}catch{}return t.response().code(200)},changeTalkRoomMessageReceipt:async(e,t)=>{const a=e.auth.artifacts,o=e.payload;try{await i.user.update({where:{id:a.id},data:{talkRoomMessageReceipt:o.receipt}})}catch{}return t.response().code(200)},changeShowReceiveMessage:async(e,t)=>{const a=e.auth.artifacts,o=e.payload;return await i.user.update({where:{id:a.id},data:{showReceiveMessage:o.showReceiveMessage}}),t.response().code(200)},changeIntro:async(e,t)=>{const a=e.auth.artifacts,o=e.payload;return await i.user.update({where:{id:a.id},data:{intro:o.intro}}),t.response().code(200)}}},302:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=void 0;const r=a(212),i=o(a(8366)),n=a(4801),d=o(a(4065)),s=a(1151),l=a(6760),c=a(2306),u=a(8396),p=new r.PrismaClient;t.handlers={updateUser:async(e,t)=>{const a=e.auth.artifacts,{deleteAvatar:o,deleteBackGroundItem:r,avatarExt:i,backGroundItemExt:n,...d}=e.payload;let l,c,u;if(d.avatar&&i&&!o){const e=await s.createS3ObjectPath({data:d.avatar,domain:"avatar",id:a.id,ext:i});l=e?e.source:a.avatar}else l=o?null:a.avatar;if(d.backGroundItem&&n&&!r){const e=await s.createS3ObjectPath({data:d.backGroundItem,domain:"backGroundItem",id:a.id,sourceType:d.backGroundItemType,ext:n});if(!e)throw new Error;c=e.source,u=d.backGroundItemType?d.backGroundItemType:null}else r?(c=null,u=null):(c=a.backGroundItem,u=a.backGroundItemType);return await p.user.update({where:{id:a.id},data:{...a,...d,avatar:l,backGroundItem:c,backGroundItemType:u},select:{id:!0,name:!0,avatar:!0,introduce:!0,statusMessage:!0,backGroundItem:!0,backGroundItemType:!0,instagram:!0,twitter:!0,youtube:!0,tiktok:!0}})},updateLocation:async(e,t)=>{const a=e.auth.artifacts,o=e.payload,r=d.default.encode(o.lat,o.lng,u.geohashPrecision),s=d.default.encode(o.lat,o.lng,7),l=c.createHash(r),h=c.createHash(s),m=c.handleUserLocationCrypt(o.lat,o.lng,"encrypt"),f=await p.privateZone.findMany({where:{userId:a.id}}),v=n.point([o.lng,o.lat]),g=f.find((e=>{const t=c.handleUserLocationCrypt(e.lat,e.lng,"decrypt"),a=n.point([t.lng,t.lat]);return i.default(a,v)<=Number(process.env.PRIVATE_ZONE_RANGE)}));return await p.user.update({where:{id:a.id},data:{...m,inPrivateZone:!!g,geohash:l,geohash7:h}}),t.response().code(200)},deleteLocation:async(e,t)=>{const a=e.auth.artifacts;try{await p.user.update({where:{id:a.id},data:{lat:null,lng:null,geohash:null,geohash7:null,inPrivateZone:!1}})}catch{return l.throwInvalidError("削除に失敗しました")}return t.response().code(200)},getUserPageInfo:async(e,t)=>{const a=e.auth.artifacts,o=e.params,r=await p.user.findUnique({where:{id:o.userId},select:{id:!0,name:!0,avatar:!0,introduce:!0,backGroundItem:!0,backGroundItemType:!0,instagram:!0,twitter:!0,youtube:!0,tiktok:!0,posts:{orderBy:{createdAt:"desc"}},flashes:{include:{viewed:{select:{userId:!0}}}},blocks:{select:{blockTo:!0}},blocked:{select:{blockBy:!0}}}});if(!r)return l.throwInvalidError();const{blocked:i,blocks:n,...d}=r,s=i.some((e=>e.blockBy===a.id)),c=n.some((e=>e.blockTo===a.id)),u=s||c;return{...d,posts:u?[]:r.posts,flashes:u?[]:r.flashes,introduce:u?"":r.introduce,instagram:u?null:r.instagram,twitter:u?null:r.twitter,youtube:u?null:r.youtube,tiktok:u?null:r.tiktok,blockTo:s}},refreshMyData:async(e,t)=>{const a=e.auth.artifacts,o=await p.user.findUnique({where:{id:a.id},select:{id:!0,name:!0,avatar:!0,introduce:!0,backGroundItem:!0,backGroundItemType:!0,instagram:!0,twitter:!0,youtube:!0,tiktok:!0,videoEditDescription:!0,statusMessage:!0,lat:!0,lng:!0,display:!0,talkRoomMessageReceipt:!0,showReceiveMessage:!0,posts:{orderBy:{createdAt:"desc"}},flashes:{include:{viewed:{select:{userId:!0}}}}}});if(!o)return l.throwInvalidError();const{posts:r,flashes:i,...n}=o,{lat:d,lng:s,...u}=n;let h=null,m=null;if(d&&s){const{lat:e,lng:t}=c.handleUserLocationCrypt(d,s,"decrypt");h=e,m=t}return{...n,lat:h,lng:m,posts:r,flashes:i}}}},6977:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.viewedFlashHandler=void 0;const o=new(a(212).PrismaClient);t.viewedFlashHandler={createViewedFlash:async(e,t)=>{const a=e.auth.artifacts,r=e.payload;if(await o.viewedFlash.findUnique({where:{userId_flashId_unique:{userId:a.id,flashId:r.flashId}}}))return t.response().code(200);try{await o.viewedFlash.create({data:{flashId:r.flashId,userId:a.id}})}catch{}return t.response().code(200)}}},1151:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createS3ObjectPath=void 0;const r=o(a(3480)),i=o(a(742)),n=o(a(5747)),d=o(a(5114)),s=o(a(1669)),l=a(2306),c=a(8835),u=s.default.promisify(n.default.writeFile),p=s.default.promisify(n.default.unlink),h=s.default.promisify(n.default.readFile),m=new r.default.S3({accessKeyId:process.env.AWS_KEY,secretAccessKey:process.env.AWS_SECRET_KEY,region:process.env.AWS_REGION}),f=async e=>await m.upload(e).promise().then((e=>e.Location)).catch((e=>{throw console.log(e),new Error})),v=(e,t)=>{const a=t.width.toString(),o=t.height.toString(),r=`./tmp/video/"${l.createRandomString().replace(/\//g,"")}.mp4`;return new Promise((async t=>{try{d.default(e).size(`${a}x${o}`).videoCodec("libx264").toFormat("mp4").save(r).on("end",(async()=>{const e=await h(r);t(e),await p(r)}))}catch{await p(r)}}))},g=e=>{const t=l.createRandomString().replace(/\//g,""),a=`./tmp/thumbnails/${t}.png`;return new Promise((async o=>{try{d.default(e).screenshots({count:1,timestamps:[0],size:"720x1280",folder:"./tmp/thumbnails",filename:`${t}.png`}).on("end",(async()=>{const e=await h(a),t=await i.default(e).webp().toBuffer();o(t),await p(a)}))}catch{await p(a)}}))};t.createS3ObjectPath=async({data:e,domain:t,id:a,sourceType:o="image",ext:r})=>{let n,d;switch(o){case"image":n="image/webp",d="webp";break;case"video":n="video/mp4",d="mp4"}const{width:s,height:h}=(e=>{switch(e){case"post":return{width:768,height:1024};case"flash":return{width:720,height:1280};case"avatar":return{width:500,height:500};case"backGroundItem":return{width:768,height:1024};case"recommendationClient":return{width:500,height:500};case"recommendation":return{width:960,height:640};default:return{width:500,height:500}}})(t),m=l.createRandomString().replace(/\//g,"w"),y=`${a}/${t}/${m}.${d}`,w=e.replace(/^data:\w+\/\w+;base64,/,""),_=Buffer.from(w,"base64"),b={Bucket:process.env.BUCKET_NAME,Key:y,ContentType:n};let P,I;if("image"===o)P=await i.default(_).rotate().resize(s,h).webp().toBuffer();else{const e=`./tmp/video/"${l.createRandomString().replace(/\//g,"")}.${r}`;try{await u(e,_);const t=await Promise.all([v(e,{width:s,height:h}),g(e)]);P=t[0],I=t[1],await p(e)}catch{await p(e)}}const k={...b,Body:P};let T,M;if(I&&(T={Bucket:process.env.BUCKET_NAME,Key:`${a}/${t}/${m}_thumbnail.webp`,ContentType:"image/webp",Body:I}),T){const e=await Promise.all([f(k),f(T)]);M={source:e[0],thumbnail:e[1]}}else{const e=await f(k);M={source:`${process.env.CLOUD_FRONT_ORIGIN}${new c.URL(e).pathname}`}}return M}},2306:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleAddressCrypt=t.handleUserLocationCrypt=t.createRandomString=t.createHash=void 0;const r=o(a(419)),i=o(a(6902)),n=a(1231);t.createHash=e=>i.default(process.env.HASH_NONCE+e).toString(r.default.enc.Base64),t.createRandomString=()=>{const e=(new Date).getTime().toString(),t=Math.floor(1e4*Math.random()),a=n.v4();return i.default(e+t+a).toString(r.default.enc.Base64)},t.handleUserLocationCrypt=(e,t,a)=>{if("number"==typeof e&&"number"==typeof t&&"encrypt"===a)return{lat:r.default.AES.encrypt(String(e),process.env.USER_LOCATION_KEY||"testkey").toString(),lng:r.default.AES.encrypt(String(t),process.env.USER_LOCATION_KEY||"testkey").toString()};if("string"==typeof e&&"string"==typeof t&&"decrypt"===a){const a=r.default.AES.decrypt(e,process.env.USER_LOCATION_KEY||"testkey").toString(r.default.enc.Utf8),o=r.default.AES.decrypt(t,process.env.USER_LOCATION_KEY||"testkey").toString(r.default.enc.Utf8);return{lat:Number(a),lng:Number(o)}}},t.handleAddressCrypt=(e,t)=>"encrypt"===t?r.default.AES.encrypt(e,process.env.USER_LOCATION_KEY||"testkey").toString():r.default.AES.decrypt(e,process.env.USER_LOCATION_KEY||"testkey").toString(r.default.enc.Utf8)},6760:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.throwInvalidError=t.throwLoginError=void 0;const r=o(a(7796)),i=a(5854);t.throwLoginError=()=>{const e=r.default.unauthorized();throw e.output.payload.errorType=i.loginErrorType,e},t.throwInvalidError=(e="無効なリクエストです")=>{const t=r.default.badRequest();throw t.output.payload.message=e,t.output.payload.errorType=i.invalidErrorType,t}},5802:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.pushNotificationToMany=t.pushNotificationToOne=void 0;const r=o(a(4054));t.pushNotificationToOne=async e=>{await r.default.messaging().send(e)},t.pushNotificationToMany=async e=>{await r.default.messaging().sendMulticast(e)}},5001:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteExpiredViewedFlashes=void 0;const o=a(212),r=a(3879),i=a(8396),n=new o.PrismaClient;t.deleteExpiredViewedFlashes=()=>{const e=r.subHours(new Date,i.flashDisplayTime);n.viewedFlash.deleteMany({where:{createdAt:{lt:e}}})}},4832:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Nonce=void 0;const o=new(a(212).PrismaClient);t.Nonce={create:async({nonce:e})=>await o.nonce.create({data:{nonce:e}}),findFirst:async({nonce:e})=>await o.nonce.findFirst({where:{nonce:e}})}},1190:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clientSignupTokenPlugin=void 0;const o=a(8105);t.clientSignupTokenPlugin={name:"app/route/clientSignupToken",register:o.clientSignupTokenRoute}},8331:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deviceTokenPlugin=void 0;const o=a(3220);t.deviceTokenPlugin={name:"app/routes/deviceToken",register:o.deviceTokenRoute}},7760:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flashStampsPlugin=void 0;const o=a(2030);t.flashStampsPlugin={name:"app/routes/flashStamps",register:o.flashStampsRoute}},3643:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flashesPlugin=void 0;const o=a(9634);t.flashesPlugin={name:"app/routes/flashes",register:o.flashesRoute}},262:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.nearbyUsersPlugin=void 0;const o=a(9288);t.nearbyUsersPlugin={name:"app/routes/nearbyUsers",register:o.nearbyUsersRoute}},8263:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.noncePlugin=void 0;const o=a(4371);t.noncePlugin={name:"app/routes/nonce",register:o.nonce}},1550:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postsPlugin=void 0;const o=a(5043);t.postsPlugin={name:"app/routes/posts",register:o.postsRoute}},9711:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.prismaPlugin=void 0;const o=a(212);t.prismaPlugin={name:"prisma",register:async e=>{const t=new o.PrismaClient;e.app.prisma=t,e.ext({type:"onPostStop",method:async e=>{e.app.prisma.$disconnect()}})}}},1916:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.privateTimePlugin=void 0;const o=a(593);t.privateTimePlugin={name:"app/routes/privateTime",register:o.privateTimeRoute}},9078:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.privateZonePlugin=void 0;const o=a(2330);t.privateZonePlugin={name:"app/route/privateZone",register:o.privateZoneRoute}},6509:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readTalkRoomMessagesPlugin=void 0;const o=a(9552);t.readTalkRoomMessagesPlugin={name:"app/routes/readTalkRoomMessages",register:o.readTalkRoomMessagesRoute}},4157:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationClientNotificationsPlugin=void 0;const o=a(410);t.recommendationClientNotificationsPlugin={name:"app/route/recommendationClientNotificatoins",register:o.recommendationClientNotificationRoute}},6737:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationClientReadNotificationPlugin=void 0;const o=a(9632);t.recommendationClientReadNotificationPlugin={name:"app/route/recommendationClientReadNotificatoins",register:o.recommendationClientReadNotificationRoute}},1445:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationClientsPlugin=void 0;const o=a(4431);t.recommendationClientsPlugin={name:"app/route/recommendationClients",register:o.recommendationClientsRoute}},4653:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationsPlugin=void 0;const o=a(1285);t.recommendationsPlugin={name:"app/route/recommendations",register:o.recommendationsRoute}},2182:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rootPlugin=void 0;const o=a(9474);t.rootPlugin={name:"app/routes/root",register:o.root}},5601:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sesisonsPlugin=void 0;const o=a(889);t.sesisonsPlugin={name:"app/routes/sessions",register:o.sessionsRoute}},7335:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.talkRoomMessagesPlugin=void 0;const o=a(7125);t.talkRoomMessagesPlugin={name:"app/routes/talkRoomMessages",register:o.talkRoomMessagesRoute}},7134:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.talkRoomsPlugin=void 0;const o=a(3168);t.talkRoomsPlugin={name:"app/routes/talkRooms",register:o.talkRoomsRoute}},9446:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.userHideRecommendatoinsPlugin=void 0;const o=a(4485);t.userHideRecommendatoinsPlugin={name:"app/route/userHideRecommendations",register:o.userHideRecommendationsRoute}},4452:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.usersPlugin=void 0;const o=a(9038);t.usersPlugin={name:"app/routes/users",register:o.usersRoute}},328:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.viewedFlashesPlugin=void 0;const o=a(161);t.viewedFlashesPlugin={name:"app/routes/viewedFlashes",register:o.viewedFlashesRoute}},4020:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.blockesRoute=void 0;const o=a(8396),r=a(5543),i=a(9309);t.blockesRoute=async e=>{e.route([{method:"POST",path:`${o.baseUrl}/users/block`,handler:i.handlers.create,options:{validate:{payload:r.validaotors.create.validaotor.payload,failAction:r.validaotors.create.failAction}}},{method:"DELETE",path:`${o.baseUrl}/users/{userId}/block`,handler:i.handlers._delete,options:{validate:{params:r.validaotors.delete.validaotor.params,failAction:r.validaotors.delete.failAction}}}])}},5543:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validaotors=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({blockTo:r.default.string().required()})},d={params:r.default.object({userId:r.default.string().required()})};t.validaotors={create:{validaotor:n,failAction:()=>i.throwInvalidError()},delete:{validaotor:d,failAction:()=>i.throwInvalidError()}}},8105:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clientSignupTokenRoute=t.clientSignupTokenPath=void 0;const o=a(8396),r=a(9089),i=a(3714);t.clientSignupTokenPath=`${o.baseUrl}/clientSignupToken`,t.clientSignupTokenRoute=async e=>{e.route([{method:"GET",path:`${t.clientSignupTokenPath}/{signupToken}`,handler:i.clientSignupTokenHandler.getClientSignupToken,options:{auth:!1,validate:{params:r.clientSignupTokenValidator.get.validator.params,failAction:r.clientSignupTokenValidator.get.failAction}}},{method:"POST",path:`${t.clientSignupTokenPath}`,handler:i.clientSignupTokenHandler.create,options:{auth:"r-client"}}])}},9089:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.clientSignupTokenValidator=void 0;const r=o(a(4320)),i=a(6760),n={params:r.default.object({signupToken:r.default.string().required()})};t.clientSignupTokenValidator={get:{validator:n,failAction:()=>i.throwInvalidError()}}},3220:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deviceTokenRoute=void 0;const o=a(8396),r=a(4086),i=a(961);t.deviceTokenRoute=e=>{e.route([{method:"POST",path:`${o.baseUrl}/deviceToken`,handler:i.deviceTokenHandler.createDeviceToken,options:{validate:{payload:r.createDeviceTokenValidator.validate.payload,failAction:r.createDeviceTokenValidator.failAction}}}])}},4086:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceTokenValidator=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({token:r.default.string().required()})};t.createDeviceTokenValidator={validate:n,failAction:()=>i.throwInvalidError()}},2030:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flashStampsRoute=void 0;const o=a(8396),r=a(6775),i=a(5947),n=`${o.baseUrl}/flashStamps`;t.flashStampsRoute=async e=>{e.route([{method:"POST",path:n,handler:i.handlers.createFlashStamp,options:{validate:{payload:r.validators.create.validator.payload,failAction:r.validators.create.failAction}}},{method:"GET",path:`${o.baseUrl}/flashes/{flashId}/stamps`,handler:i.handlers.get,options:{validate:{params:r.validators.get.validator.params,failAction:r.validators.get.failAction}}}])}},6775:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({flashId:r.default.number().required(),value:r.default.string().valid("thumbsUp","yusyo","yoi","itibann","seikai").required()})},d={params:r.default.object({flashId:r.default.string().required()})};t.validators={get:{validator:d,failAction:()=>i.throwInvalidError()},create:{validator:n,failAction:()=>i.throwInvalidError()}}},9634:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flashesRoute=void 0;const o=a(8396),r=a(9573),i=a(3197),n=a(6524);t.flashesRoute=async e=>{e.route([{method:"POST",path:`${o.baseUrl}/flashes`,handler:i.flashesHabdler.createFlash,options:{validate:{payload:r.createFlashValidator.validate.payload,failAction:r.createFlashValidator.failAction},payload:{maxBytes:n.maxBytes}}},{method:"DELETE",path:`${o.baseUrl}/flashes/{flashId}`,handler:i.flashesHabdler.deleteFlash,options:{validate:{params:r.deleteFlashValidator.validate.params,failAction:r.deleteFlashValidator.failAction}}}])}},9573:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteFlashValidator=t.createFlashValidator=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({source:r.default.string().required(),sourceType:r.default.string().valid("image","video").required(),ext:r.default.string().required()})};t.createFlashValidator={validate:n,failAction:()=>i.throwInvalidError()};const d={params:r.default.object({flashId:r.default.string().required()})};t.deleteFlashValidator={validate:d,failAction:()=>i.throwInvalidError()}},9288:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.nearbyUsersRoute=void 0;const o=a(8396),r=a(6391),i=a(8166);t.nearbyUsersRoute=async e=>{e.route([{method:"GET",path:`${o.baseUrl}/users/nearby`,handler:i.handlers.get,options:{validate:{query:r.validators.get.validator.query,failAction:r.validators.get.failAction}}}])}},6391:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=void 0;const r=o(a(4320)),i=a(6760),n={query:r.default.object({range:r.default.number().required(),id:r.default.string().required()})};t.validators={get:{validator:n,failAction:()=>i.throwInvalidError()}}},4371:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.nonce=void 0;const o=a(833),r=a(4176),i=a(8396);t.nonce=async e=>{e.route([{method:"POST",path:`${i.baseUrl}/nonce`,handler:o.nonceHandler.create,options:{validate:{payload:r.createNonceValidator.validate,failAction:r.createNonceValidator.failAction},auth:!1}}])}},4176:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createNonceValidator=void 0;const r=o(a(4320)),i=a(6760),n=r.default.object({nonce:r.default.string().required()});t.createNonceValidator={validate:n,failAction:()=>i.throwLoginError()}},5043:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postsRoute=void 0;const o=a(8396),r=a(8726),i=a(2700),n=a(6524);t.postsRoute=async e=>{e.route([{method:"POST",path:`${o.baseUrl}/posts`,handler:i.handlers.createPost,options:{validate:{payload:r.createPostValidator.validate.payload,failAction:r.createPostValidator.failAction},payload:{maxBytes:n.maxBytes,timeout:2e4}}},{method:"DELETE",path:`${o.baseUrl}/posts/{postId}`,handler:i.handlers.deletePost,options:{validate:{params:r.deletePostValidator.validate.params,failAction:r.deletePostValidator.failAction}}},{method:"GET",path:`${o.baseUrl}/users/{userId}/posts`,handler:i.handlers.getUserPosts,options:{validate:{params:r.validators.gets.validator.params,failAction:r.validators.gets.failAction}}}])}},8726:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=t.deletePostValidator=t.createPostValidator=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({text:r.default.string().allow("").max(150).required(),source:r.default.string().required(),sourceType:r.default.string().valid("image","video").required(),ext:r.default.string().required()})};t.createPostValidator={validate:n,failAction:()=>i.throwInvalidError()};const d={params:r.default.object({postId:r.default.number().required()})};t.deletePostValidator={validate:d,failAction:()=>i.throwInvalidError()};const s={params:r.default.object({userId:r.default.string().required()})};t.validators={gets:{validator:s,failAction:()=>i.throwInvalidError()}}},593:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.privateTimeRoute=void 0;const o=a(8396),r=a(858),i=a(2669),n=`${o.baseUrl}/privateTime`;t.privateTimeRoute=async e=>{e.route([{method:"POST",path:n,handler:i.privateTimeHandler.createPrivateTime,options:{validate:{payload:r.privateTimeValidator.create.validator.payload,failAction:r.privateTimeValidator.create.failAction}}},{method:"GET",path:n,handler:i.privateTimeHandler.getPrivateTime},{method:"DELETE",path:`${n}/{id}`,handler:i.privateTimeHandler.deletePrivateTime,options:{validate:{params:r.privateTimeValidator.delete.validator.params,failAction:r.privateTimeValidator.delete.failAction}}}])}},858:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.privateTimeValidator=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({startHours:r.default.number().required(),startMinutes:r.default.number().required(),endHours:r.default.number().required(),endMinutes:r.default.number().required()})},d={params:r.default.object({id:r.default.string().required()})};t.privateTimeValidator={create:{validator:n,failAction:()=>i.throwInvalidError()},delete:{validator:d,failAction:()=>i.throwInvalidError()}}},2330:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.privateZoneRoute=void 0;const o=a(8396),r=a(6082),i=a(3535),n=`${o.baseUrl}/privateZone`;t.privateZoneRoute=async e=>{e.route([{method:"GET",path:n,handler:r.privateZoneHandler.getPrivateZone},{method:"POST",path:n,handler:r.privateZoneHandler.createPrivateZone,options:{validate:{payload:i.privateZoneValidator.create.validator.payload,failAction:i.privateZoneValidator.create.failAction}}},{method:"DELETE",path:`${n}/{id}`,handler:r.privateZoneHandler.deletePrivateZone,options:{validate:{params:i.privateZoneValidator.delete.validator.params,failAction:i.privateZoneValidator.delete.failAction}}}])}},3535:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.privateZoneValidator=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({address:r.default.string().required(),lat:r.default.number().required(),lng:r.default.number().required()})},d={params:r.default.object({id:r.default.string().required()})};t.privateZoneValidator={create:{validator:n,failAction:()=>i.throwInvalidError()},delete:{validator:d,failAction:()=>i.throwInvalidError()}}},9552:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readTalkRoomMessagesRoute=void 0;const o=a(8396),r=a(4438),i=a(6745);t.readTalkRoomMessagesRoute=async e=>{e.route([{method:"POST",path:`${o.baseUrl}/talk_rooms/{talkRoomId}/messages/read`,handler:i.handlers.create,options:{validate:{payload:r.validators.create.validator.payload,params:r.validators.create.validator.params,failAction:r.validators.create.failAction}}}])}},4438:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({ids:r.default.array().items(r.default.number()).required()}),params:r.default.object({talkRoomId:r.default.string().required()})};t.validators={create:{validator:n,failAction:()=>i.throwInvalidError()}}},410:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationClientNotificationRoute=t.recommendationClientNotificationsPath=void 0;const o=a(8396),r=a(1115),i=a(2613);t.recommendationClientNotificationsPath=`${o.baseUrl}/recommendationClientNotifications`,t.recommendationClientNotificationRoute=async e=>{e.route([{method:"GET",path:t.recommendationClientNotificationsPath,handler:r.handlers.getAll,options:{auth:"r-client"}},{method:"GET",path:`${t.recommendationClientNotificationsPath}/{id}`,handler:r.handlers.getData,options:{auth:"r-client",validate:{params:i.validators.get.validator.params,failAction:i.validators.get.failAction}}},{method:"POST",path:t.recommendationClientNotificationsPath,handler:r.handlers.create,options:{auth:"console",validate:{payload:i.validators.create.validator.payload,failAction:i.validators.create.failAction}}},{method:"GET",path:`${t.recommendationClientNotificationsPath}/unread`,handler:r.handlers.getUnread,options:{auth:"r-client"}}])}},2613:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=void 0;const r=o(a(4320)),i=a(6760),n={params:r.default.object({id:r.default.string().required()})},d={payload:r.default.object({title:r.default.string().required(),text:r.default.string().required()})};t.validators={get:{validator:n,failAction:()=>i.throwInvalidError()},create:{validator:d,failAction:()=>i.throwInvalidError()}}},9632:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationClientReadNotificationRoute=void 0;const o=a(8396),r=a(4606),i=a(8873),n=`${o.baseUrl}/recommendationClient/notifications/read`;t.recommendationClientReadNotificationRoute=async e=>{e.route([{method:"POST",path:n,handler:r.handlers.create,options:{auth:"r-client",validate:{payload:i.validators.create.validation.payload,failAction:i.validators.create.failAction}}}])}},8873:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({ids:r.default.array().items(r.default.number()).required()})};t.validators={create:{validation:n,failAction:()=>i.throwInvalidError()}}},4431:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationClientsRoute=t.recommendationClientsPath=void 0;const o=a(8396),r=a(2047),i=a(7833);t.recommendationClientsPath=`${o.baseUrl}/recommendationClients`,t.recommendationClientsRoute=async e=>{e.route([{method:"POST",path:t.recommendationClientsPath,handler:i.recommendationClientHandler.create,options:{auth:!1,validate:{payload:r.recommendationClientValidator.create.validator.payload,headers:r.recommendationClientValidator.create.validator.header,options:{allowUnknown:!0},failAction:r.recommendationClientValidator.create.failAction}}},{method:"GET",path:`${o.baseUrl}/recommendationClient`,handler:i.recommendationClientHandler.get,options:{auth:"r-client"}},{method:"PATCH",path:`${t.recommendationClientsPath}`,handler:i.recommendationClientHandler.update,options:{auth:"r-client",validate:{payload:r.recommendationClientValidator.update.validator.payload,failAction:r.recommendationClientValidator.update.failAction},payload:{timeout:2e4,maxBytes:o.maxBytes}}},{method:"PATCH",path:`${t.recommendationClientsPath}/showedPostModal`,handler:i.recommendationClientHandler.changeShowedPostModal,options:{auth:"r-client"}},{method:"DELETE",path:t.recommendationClientsPath,handler:i.recommendationClientHandler.deleteClient,options:{auth:"r-client"}}])}},2047:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationClientValidator=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({name:r.default.string().max(30).required()}),header:r.default.object({authorization:r.default.string().required()})},d={payload:r.default.object({name:r.default.string().required(),image:r.default.string().optional(),ext:r.default.string().optional(),address:r.default.string().optional(),url:r.default.string().optional(),instagram:r.default.string().optional(),twitter:r.default.string().optional(),lat:r.default.number().optional(),lng:r.default.number().optional()})};t.recommendationClientValidator={create:{validator:n,failAction:()=>i.throwInvalidError()},update:{validator:d,failAction:()=>i.throwInvalidError()}}},1285:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationsRoute=t.recommendationsPath=void 0;const o=a(8396),r=a(4287),i=a(9380);t.recommendationsPath=`${o.baseUrl}/recommendations`,t.recommendationsRoute=async e=>{e.route([{method:"POST",path:t.recommendationsPath,handler:i.recommendationHandler.create,options:{payload:{maxBytes:1e8},auth:"r-client",validate:{payload:r.recommendationValidator.create.validator.payload,failAction:r.recommendationValidator.create.failAction}}},{method:"GET",path:`${t.recommendationsPath}/client`,handler:i.recommendationHandler.getForClient,options:{auth:"r-client",validate:{query:r.recommendationValidator.getForClient.validator.query,failAction:r.recommendationValidator.getForClient.failAction}}},{method:"GET",path:`${t.recommendationsPath}/hide/{id}`,handler:i.recommendationHandler.hide,options:{auth:"r-client",validate:{params:r.recommendationValidator.hide.validator.params,failAction:r.recommendationValidator.hide.failAction}}},{method:"GET",path:`${t.recommendationsPath}`,handler:i.recommendationHandler.get,options:{validate:{query:r.recommendationValidator.get.validator.query,failAction:r.recommendationValidator.get.failAction}}}])}},4287:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationValidator=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({title:r.default.string().max(35).required(),text:r.default.string().allow("").optional(),coupon:r.default.boolean().required(),endTime:r.default.date().optional(),images:r.default.array().required()})},d={query:r.default.object({type:r.default.string().allow("now").optional()})},s={params:r.default.object({id:r.default.string().required()})},l={query:r.default.object({lat:r.default.number().required(),lng:r.default.number().required(),id:r.default.string().required()})};t.recommendationValidator={create:{validator:n,failAction:()=>i.throwInvalidError()},getForClient:{validator:d,failAction:()=>i.throwInvalidError()},hide:{validator:s,failAction:()=>i.throwInvalidError()},get:{validator:l,failAction:()=>i.throwInvalidError()}}},9474:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.root=void 0,t.root=async e=>{e.route({method:"GET",path:"/",handler:(e,t)=>"Hello World",options:{auth:!1}})}},889:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sessionsRoute=t.logoutPath=t.sessionLoginPath=t.lineLoginPath=void 0;const o=a(2007),r=a(3560),i=a(8396);t.lineLoginPath=`${i.baseUrl}/sessions/lineLogin`,t.sessionLoginPath=`${i.baseUrl}/login_data`,t.logoutPath=`${i.baseUrl}/sessions/logout`,t.sessionsRoute=async e=>{e.route([{method:"POST",path:t.lineLoginPath,handler:r.sessionsHandler.lineLogin,options:{validate:{headers:o.sessionsValidator.lineLogin.validate.headers,options:{allowUnknown:!0},failAction:o.sessionsValidator.lineLogin.failAction},auth:!1}},{method:"GET",path:t.sessionLoginPath,handler:r.sessionsHandler.sessionLogin},{method:"GET",path:t.logoutPath,handler:r.sessionsHandler.logout},{method:"GET",path:`${i.baseUrl}/sampleLogin`,handler:r.sessionsHandler.sampleLogin,options:{auth:!1}}])}},2007:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sessionsValidator=t.lineLoginValidator=void 0;const r=o(a(4320)),i=a(6760);t.lineLoginValidator={headers:r.default.object({authorization:r.default.string().required()})},t.sessionsValidator={lineLogin:{validate:t.lineLoginValidator,failAction:(e,t,a)=>i.throwLoginError()}}},7125:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.talkRoomMessagesRoute=void 0;const o=a(8396),r=a(9577),i=a(7964);t.talkRoomMessagesRoute=async e=>{e.route([{method:"POST",path:`${o.baseUrl}/talk_rooms/{talkRoomId}/messages`,handler:i.handlers.create,options:{validate:{payload:r.validators.create.validator.payload,params:r.validators.create.validator.params,failAction:r.validators.create.failAction}}},{method:"GET",path:`${o.baseUrl}/talk_rooms/{talkRoomId}/messages`,handler:i.handlers.gets,options:{validate:{params:r.validators.gets.validator.params,failAction:r.validators.gets.failAction}}}])}},9577:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({text:r.default.string().required(),partnerId:r.default.string().required()}),params:r.default.object({talkRoomId:r.default.string().required()})},d={params:r.default.object({talkRoomId:r.default.string().required()})};t.validators={gets:{validator:d,failAction:()=>i.throwInvalidError()},create:{validator:n,failAction:()=>i.throwInvalidError()}}},3168:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.talkRoomsRoute=void 0;const o=a(8396),r=a(5799),i=a(731);t.talkRoomsRoute=async e=>{e.route([{method:"POST",path:`${o.baseUrl}/talkRooms`,handler:i.handlers.createTalkRoom,options:{validate:{payload:r.validators.create.validator.payload,failAction:r.validators.create.failAction}}},{method:"DELETE",path:`${o.baseUrl}/talkRooms/{talkRoomId}`,handler:i.handlers.deleteTalkRoom,options:{validate:{params:r.validators.delete.validator.params,failAction:r.validators.delete.failAction}}},{method:"GET",path:`${o.baseUrl}/users/{userId}/talk_rooms`,handler:i.handlers.get,options:{validate:{params:r.validators.get.validator.params,failAction:r.validators.get.failAction}}}])}},5799:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({partnerId:r.default.string().required()})},d={params:r.default.object({talkRoomId:r.default.number().required()})},s={params:r.default.object({userId:r.default.string().required()})};t.validators={get:{validator:s,failAction:()=>i.throwInvalidError()},delete:{validator:d,failAction:()=>i.throwInvalidError()},create:{validator:n,failAction:()=>i.throwInvalidError()}}},4485:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.userHideRecommendationsRoute=t.userHideRecommendationsPath=void 0;const o=a(8396),r=a(1537),i=a(4244);t.userHideRecommendationsPath=`${o.baseUrl}/userHideRecommendations`,t.userHideRecommendationsRoute=async e=>{e.route([{method:"POST",path:t.userHideRecommendationsPath,handler:i.handlers.create,options:{validate:{payload:r.validators.create.validator.payload,failAction:r.validators.create.failAction}}}])}},1537:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({id:r.default.number().required()})};t.validators={create:{validator:n,failAction:()=>i.throwInvalidError()}}},1542:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.userSettingsRoute=void 0;const o=a(8396),r=a(5458),i=a(5900);t.userSettingsRoute=async e=>{e.route([{method:"PUT",path:`${o.baseUrl}/users/display`,handler:i.handlers.changeDisplay,options:{validate:{payload:r.validators.changeDisplay.validator.payload,failAction:r.validators.changeDisplay.failAction}}},{method:"PUT",path:`${o.baseUrl}/users/videoEditDescription`,handler:i.handlers.changeVideoEditDescription,options:{validate:{payload:r.validators.changeVideoEditDescription.validator.payload,failAction:r.validators.changeVideoEditDescription.failAction}}},{method:"PUT",path:`${o.baseUrl}/users/talkRoomMessageReceipt`,handler:i.handlers.changeTalkRoomMessageReceipt,options:{validate:{payload:r.validators.changeTalkRoomMessageReceipt.validator.payload,failAction:r.validators.changeTalkRoomMessageReceipt.failAction}}},{method:"PUT",path:`${o.baseUrl}/users/showReceiveMessage`,handler:i.handlers.changeShowReceiveMessage,options:{validate:{payload:r.validators.changeShowReceiveMessage.validator.payload,failAction:r.validators.changeShowReceiveMessage.failAction}}},{method:"PUT",path:`${o.baseUrl}/users/intro`,handler:i.handlers.changeIntro,options:{validate:{payload:r.validators.changeIntro.validator.payload,failAction:r.validators.changeIntro.failAction}}}])}},5458:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=void 0;const r=o(a(4320)),i=a(6760),n=()=>i.throwInvalidError(),d={payload:r.default.object({display:r.default.boolean().required()})},s={payload:r.default.object({videoEditDescription:r.default.boolean().required()})},l={payload:r.default.object({receipt:r.default.boolean().required()})},c={payload:r.default.object({showReceiveMessage:r.default.boolean().required()})},u={payload:r.default.object({intro:r.default.boolean().required()})};t.validators={changeDisplay:{validator:d,failAction:n},changeVideoEditDescription:{validator:s,failAction:n},changeTalkRoomMessageReceipt:{validator:l,failAction:n},changeShowReceiveMessage:{validator:c,failAction:n},changeIntro:{validator:u,failAction:n}}},9038:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.usersRoute=void 0;const o=a(3845),r=a(302),i=a(8396),n=a(6524),d=`${i.baseUrl}/users/location`;t.usersRoute=async e=>{e.route([{method:"GET",path:`${i.baseUrl}/users/{userId}/page_info`,handler:r.handlers.getUserPageInfo,options:{validate:{params:o.validators.getUser.validator.params,failAction:o.validators.getUser.failAction}}},{method:"GET",path:`${i.baseUrl}/my_refresh_data`,handler:r.handlers.refreshMyData},{method:"PATCH",path:`${i.baseUrl}/users`,handler:r.handlers.updateUser,options:{validate:{...o.updateUserValidator.validate,failAction:o.updateUserValidator.failAction},payload:{maxBytes:n.maxBytes}}},{method:"PATCH",path:`${i.baseUrl}/users/location`,handler:r.handlers.updateLocation,options:{validate:{payload:o.updateLocationValidator.validate.payload,failAction:o.updateLocationValidator.failAction}}},{method:"DELETE",path:d,handler:r.handlers.deleteLocation}])}},3845:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validators=t.updateLocationValidator=t.updateUserValidator=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({name:r.default.string().required(),avatar:r.default.string().optional(),avatarExt:r.default.string().allow(null).optional(),introduce:r.default.string().allow("").required(),statusMessage:r.default.string().allow("").required(),deleteAvatar:r.default.boolean().required(),backGroundItem:r.default.string().optional(),backGroundItemType:r.default.string().valid("image","video").optional(),deleteBackGroundItem:r.default.boolean().required(),backGroundItemExt:r.default.string().allow(null).optional(),instagram:r.default.string().allow(null),twitter:r.default.string().allow(null),youtube:r.default.string().allow(null),tiktok:r.default.string().allow(null)})};t.updateUserValidator={validate:n,failAction:()=>i.throwInvalidError("無効なデータが含まれています")};const d={payload:r.default.object({lat:r.default.number().required(),lng:r.default.number().required()})};t.updateLocationValidator={validate:d,failAction:()=>i.throwInvalidError()};const s={params:r.default.object({userId:r.default.string().required()})};t.validators={getUser:{validator:s,failAction:()=>i.throwInvalidError()}}},161:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.viewedFlashesRoute=void 0;const o=a(8396),r=a(461),i=a(6977);t.viewedFlashesRoute=async e=>{e.route([{method:"POST",path:`${o.baseUrl}/flashes/viewed`,handler:i.viewedFlashHandler.createViewedFlash,options:{validate:{payload:r.createViewedFlashValidator.validate.payload,failAction:r.createViewedFlashValidator.failAction}}}])}},461:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createViewedFlashValidator=void 0;const r=o(a(4320)),i=a(6760),n={payload:r.default.object({flashId:r.default.number().required()})};t.createViewedFlashValidator={validate:n,failAction:()=>i.throwInvalidError()}},6873:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.startServer=t.initializeServer=t.talkRoomMessageNameSpace=t.io=void 0;const r=o(a(5787)),i=o(a(5500)),n=o(a(2395)),d=o(a(4054)),s=o(a(4199)),l=a(3157),c=a(6760),u=a(3582),p=a(2182),h=a(9711),m=a(8263),f=a(5601),v=a(4452),g=a(1550),y=a(3643),w=a(328),_=a(262),b=a(7134),P=a(7335),I=a(6509),k=a(8331),T=a(7760),M=a(9078),R=a(1916),E=a(5001),A=a(1445),O=a(1190),j=a(4653),C=a(4157),S=a(9446),q=a(6737),U=a(4020),H=a(1542),V=r.default.server({port:process.env.PORT||4001});t.io=new n.default.Server(V.listener),t.talkRoomMessageNameSpace=t.io.of("/talkRoomMessages"),u.setupSocketIo(),d.default.initializeApp({credential:d.default.credential.applicationDefault()}),d.default.initializeApp({credential:d.default.credential.cert({projectId:process.env.CLIENT_FIREBASE_PROJECT_ID,clientEmail:process.env.CLIENT_FIREBASE_EMAIL,privateKey:process.env.CLIENT_FIREBASE_PRIVATE_KEY.replace(/\\n/g,"\n")})},"recommendationClient"),d.default.initializeApp({credential:d.default.credential.cert({projectId:process.env.CONSOLE_FIREBASE_PROJECT_ID,clientEmail:process.env.CONSOLE_FIREBASE_EMAIL,privateKey:process.env.CONSOLE_FIREBASE_PRIVATE_KEY.replace(/\\n/g,"\n")})},"console"),t.initializeServer=async()=>(await V.register(i.default),V.auth.strategy("simple","bearer-access-token",{validate:l.checkBeareAccessToken,unauthorized:()=>{console.log("認可失敗"),c.throwLoginError()}}),V.auth.strategy("r-client","bearer-access-token",{validate:l.checkRecommendationClient,unauthorized:()=>{c.throwLoginError()}}),V.auth.strategy("console","bearer-access-token",{validate:l.checkConsoleAdmin,unauthorized:()=>{c.throwLoginError()}}),V.auth.default("simple"),await V.register({plugin:a(5378),options:{prettyPrint:!0,redact:["req.headers.authorization"],logPayload:!1,logQueryParams:!0}}),await V.register([h.prismaPlugin,m.noncePlugin,p.rootPlugin,f.sesisonsPlugin,v.usersPlugin,g.postsPlugin,y.flashesPlugin,w.viewedFlashesPlugin,_.nearbyUsersPlugin,b.talkRoomsPlugin,P.talkRoomMessagesPlugin,I.readTalkRoomMessagesPlugin,k.deviceTokenPlugin,T.flashStampsPlugin,M.privateZonePlugin,R.privateTimePlugin,A.recommendationClientsPlugin,O.clientSignupTokenPlugin,j.recommendationsPlugin,C.recommendationClientNotificationsPlugin,S.userHideRecommendatoinsPlugin,q.recommendationClientReadNotificationPlugin]),U.blockesRoute(V),H.userSettingsRoute(V),await V.initialize(),V),t.startServer=async e=>(s.default.schedule("0 0 0 * * *",E.deleteExpiredViewedFlashes),await e.start(),console.log("サーバー起動: "+e.info.uri),e)},3582:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setupSocketIo=void 0;const o=a(6873);t.setupSocketIo=()=>{o.talkRoomMessageNameSpace.on("connection",(async e=>{const t=e.handshake.query;t&&await e.join(t.id)}))}},3147:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.confirmInTime=t.formatDate=t.filterByDayDiff=void 0;const o=a(8396);t.filterByDayDiff=(e,t)=>((new Date).getTime()-new Date(e).getTime())/o.dayMs<t,t.formatDate=({date:e})=>`${new Date(e).getFullYear()}/${new Date(e).getMonth()+1}/${new Date(e).getDate()}`,t.confirmInTime=({startHours:e,startMinutes:t,endHours:a,endMinutes:o,h:r,m:i})=>e<a?e===r?t<=i:a===r?i<=o:e<r&&r<a:e===a?t===o?e===r&&t===i:e===r&&t<=i&&i<=o:e===r?t<=i:a===r?i<=o:r>e||r<a},7796:e=>{e.exports=require("@hapi/boom")},5787:e=>{e.exports=require("@hapi/hapi")},212:e=>{e.exports=require("@prisma/client")},8366:e=>{e.exports=require("@turf/distance")},4801:e=>{e.exports=require("@turf/helpers")},3480:e=>{e.exports=require("aws-sdk")},2376:e=>{e.exports=require("axios")},419:e=>{e.exports=require("crypto-js")},6902:e=>{e.exports=require("crypto-js/sha256")},3879:e=>{e.exports=require("date-fns")},4054:e=>{e.exports=require("firebase-admin")},5114:e=>{e.exports=require("fluent-ffmpeg")},5747:e=>{e.exports=require("fs")},5500:e=>{e.exports=require("hapi-auth-bearer-token")},5378:e=>{e.exports=require("hapi-pino")},4320:e=>{e.exports=require("joi")},4065:e=>{e.exports=require("ngeohash")},4199:e=>{e.exports=require("node-cron")},7617:e=>{e.exports=require("prisma/prisma-client")},742:e=>{e.exports=require("sharp")},2395:e=>{e.exports=require("socket.io")},8835:e=>{e.exports=require("url")},1669:e=>{e.exports=require("util")},1231:e=>{e.exports=require("uuid")}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,a),i.exports}(()=>{const e=a(6873);(async()=>{const t=await e.initializeServer();await e.startServer(t)})()})()})();